
<!DOCTYPE html>
<html>
<head>
  <!--
    Kilsbergen MkDocs theme copyright 2019 Ruud van Asseldonk.
    Licensed under the Apache 2.0 license.
    See https://github.com/ruuda/kilsbergen.
  -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Search — Musium</title>
  <!-- Out of the options of rsms.me + Google Fonts, self-hosting, and only
    Google Fonts, the latter is by far the fastest when the docs themselves are
    not on a CDN, even though it's two additional domains to connect to. -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&display=swap" rel="stylesheet">
  <link href="https://docs.ruuda.nl/musium/search/" rel="canonical">
  <style>
  /* Inter font family, copyright Rasmus Andersson, licensed under SIL OFL 1.1,
     see https://rsms.me/inter and https://rsms.me/inter/inter.css. */
  @font-face {
    font-family: 'Inter';
    font-style: normal;
    font-weight: 100 900;
    font-display: swap;
    src: url('https://rsms.me/inter/font-files/Inter-roman.var.woff2?v=3.19') format('woff2');
    font-named-instance: 'Regular';
  }
  @font-face {
    font-family: 'Inter';
    font-style: italic;
    font-weight: 100 900;
    font-display: swap;
    src: url('https://rsms.me/inter/font-files/Inter-italic.var.woff2?v=3.19') format('woff2');
    font-named-instance: 'Italic';
  }
  /* Modular scale with exponent 1.7^(1/3). The 1.7 was chosen as the line hight
     that goes well with Inter. Previously I used 1.59, but it was just too tight.
     0.59em
     0.70em
     1.00em
     1.19em
     1.42em
     1.70em
     2.02em
     2.42em
  */
  * { margin: 0; padding: 0; border-spacing: 0; }
  html {
    font-family: Inter, Roboto, sans-serif;
    /*
    Turn on character variant 8 for Inter, which puts serifs on the uppercase I.
    Also turn on variant 1, which has a curved 1.
    Disable contextual alternates for now. There is a bug, either in Inter or
    in Chrome (https://crbug.com/1046095) that causes colons after a <strong> to
    be raised above the baseline.
    */
    font-feature-settings: 'cv01' 1, 'cv08' 1, 'calt' 0;

    font-size: 16px;
    line-height: 1.7em;
    background-color: #fff;
    height: 100%;
  }
  em {
    font-style: italic;
  }
  body {
    height: 100%;
  }
  #content {
    display: grid;
    grid-template-columns: auto 16rem 50rem auto;
    color: #333;
    min-height: 100%;
  }
  #main {
    grid-area: 1 / 3 / 2 / 4;
    padding: 2.2rem;
    padding-left: 4rem;
    padding-right: 4rem;
    overflow: hidden;
  }
  #breadcrumbs {
    margin-bottom: 3rem;
    word-spacing: 0.3em;
    color: #78a;
  }
  #breadcrumbs a {
    word-spacing: 0;
    color: #78a;
  }
  article {
    margin-top: 1.3rem;
  }
  h1, h2, h3 {
    font-weight: 600;
    font-size: 1rem;
    color: #444;
    position: relative;
  }
  h1 {
    font-size: 2rem;
    margin-bottom: 2.1rem;
    line-height: 2.42rem;
    margin-top: -0.35rem;
    margin-bottom: 1.75rem;
  }
  h2 {
    font-size: 1.42rem;
    margin-top: 3.5rem;
    margin-bottom: 1.6rem;
  }
  .headerlink {
    position: absolute;
    left: -0.9em;
    width: 1em;
    opacity: 0.0;
    transition: opacity 0.2s ease-in;
  }
  /* Don't show the link for h1, usually you only have a single h1 at the top
     of the page, so it doesn't make much sense to add an anchor there, and with
     the larger font size, it doesn't fit in a narrow viewport. */
  h2:hover .headerlink, h3:hover .headerlink {
    opacity: 1.0;
  }
  code {
    font-family: 'Roboto Mono', monospace;
    font-size: 0.84rem;
    line-height: 1.5rem;
  }
  h3 > code {
    /* Roboto Mono 500 is about as heavy as Inter semibold (600). */
    font-weight: 500;
  }
  abbr {
    text-transform: uppercase;
    /* Downsize so caps are x-height, and compensate weight loss. */
    font-size: 0.78rem;
    font-weight: 500;
    letter-spacing: 0.05rem;
    /* Prevent abbrs from changing the line height of lines in which they occur. */
    line-height: 0;
  }
  sub, sup {
    /* Don't disturb the line height of normal text. */
    line-height: 0rem;
    font-size: 0.78rem;
    font-weight: 500;
  }
  p > code,
  a > code,
  h3 > code,
  li > code,
  td > code,
  dt > code,
  dd > code {
    background-color: #f0f0f0;
    padding: 0.13rem;
    padding-left: 0.3rem;
    padding-right: 0.3rem;
    border-radius: 0.2rem;
    line-height: 1rem;
  }
  h3 {
    padding-top: 0.9rem;
    padding-bottom: 0.8rem;
  }
  h3 > code {
    margin-left: -0.1rem;
  }
  a {
    color: #36d;
    text-decoration: none;
  }
  p, ul, ol, dl, pre, table {
    /* Same space as line height, leave exactly one line blank. */
    margin-bottom: 1.7rem;
  }
  pre {
    padding-top: 0.8rem;
    padding-bottom: 0.9rem;
    padding-left: 1.19rem;
    padding-right: 0;
    background-color: #f8f8f8;
    border-radius: 0 0.2rem 0.2rem 0;
    border-left: 0.3rem solid #d5d8e0;
    overflow-x: auto;
  }
  pre > code {
    margin-right: 1.41rem;
    color: #555;
  }
  code .k { color: #36d; }
  code .kt, code .nb { color: #d36; }
  code .c1, code .cm { color: #d36; font-style: italic; }
  code .s { color: #c43; }
  ul, ol {
    list-style-type: none;
    counter-reset: item;
  }
  table {
    font-variant-numeric: tabular-nums;
  }
  th, td {
    padding-right: 2rem;
  }
  th {
    text-align: left;
  }
  td > img {
    display: block;
    padding-top: 1em;
    padding-bottom: 1em;
  }
  dl {
    display: grid;
    grid-template-columns: 1fr 4fr;
    grid-column-gap: 2em;
  }
  dl dt {
    text-align: right;
  }
  #main ul li:before {
    color: #555;
    content: '\2022';
    display: inline-block;
    font-weight: 700;
    margin-left: -0.9rem;
    width: 0.9rem;
  }
  #main ul li {
    margin-left: 0.87rem;
  }
  #main ol li:before {
    content: counter(item);
    display: inline-block;
    font-weight: 700;
    width: 0.8rem;
    margin-left: -1.6rem;
    padding-right: 0.8rem;
  }
  #main ol li {
    margin-left: 1.6rem;
    counter-increment: item;
  }
  #nav-prev-next {
    margin-top: 3.4rem;
    padding-bottom: 3.3rem;
  }
  #nav-prev, #nav-next, #repo-link {
    display: inline-block;
  }
  #nav-prev {
    float: left;
  }
  #nav-next, #repo-link {
    float: right;
    text-align: right;
  }
  #nav-prev::before {
    content: '\219e';
    padding-right: 0.5em;
  }
  #nav-next::after {
    content: '\21a0';
    padding-left: 0.5em;
  }
  aside {
    grid-area: 1 / 1 / 2 / 3;
    border-right: 1px solid #eee;
    background-color: #fafafa;
    color: #78a;
  }
  aside nav {
    margin-top: 9rem;
    padding-bottom: 3.4rem;
    width: 14rem;
    float: right;
    /* Put the active chapter border over the sidebar border. */
    margin-right: -1px;
  }
  aside a {
    color: inherit;
  }
  aside .toc-section {
    font-weight: 700;
  }
  aside ul {
    margin-bottom: 0;
  }
  aside li {
    overflow: hidden;
    text-overflow: ellipsis;
  }
  aside li ul {
    padding-top: 0.6rem;
    padding-bottom: 1.1rem;
  }
  aside li.toc-section {
    margin-top: 1.7rem;
  }
  aside li.toc-section {
    color: #36d;
  }
  aside li.current, aside li ul {
    border-right: 0.3em solid #d5d8e0;
    padding-left: 1em;
    margin-left: -1em;
  }
  aside li.toc-chapter.current {
    font-weight: 600;
  }
  aside li.toc-heading {
    padding-left: 1em;
    padding-right: 0.3em;
  }

  @media(max-width: 63rem)
  {
    #content {
      /* Manual implementation of max-width: on narrower viewports,
         auto-size the body. */
      grid-template-columns: 0 16rem auto 0;
    }
  }

  @media(max-width: 1150px)
  {
    html { font-size: 15px; }
  }

  /* Move the sidebar TOC below content at small widths. */
  @media(max-width: 800px)
  {
    #content {
      display: block;
    }
    aside {
      border-top: 1px solid #eee;
      border-right: 0px none;
      padding-top: 1.7em;
    }
    aside nav {
      margin-left: 4em;
      margin-top: 1.7em;
      margin-right: 0;
      float: none;
      width: auto;
    }
    #main {
      padding-bottom: 1.7em;
    }
    /* Now that the TOC is full-width, adding the border on the right to
       highlight the active page is not as clear anymore, it can be far away.
       The current chapter is still in boldface, but that does not work for
       section indexes. So point a guillemet at it as well. */
    aside li.current, aside li ul {
      border-right: 0px none;
      position: relative;
    }
    aside li.current:before {
      content: '\203a';
      position: absolute;
      left: 0;
    }
  }

  /* Use less generous margins for very narrow viewports. */
  @media(max-width: 650px)
  {
    #main {
      padding-left: 2rem;
      padding-right: 2rem;
    }
    aside nav {
      margin-left: 2rem;
      padding-bottom: 2rem;
    }
  }

  @media(max-width: 450px)
  {
    #main {
      padding-left: 1.7em;
      padding-right: 1.7em;
    }
    aside nav {
      margin-left: 1.7em;
    }
  }
  </style>
</head>
<body>
  <div id="content">
    <div id="main">
      <nav id="breadcrumbs">
        <a href="https://docs.ruuda.nl/musium/">Musium</a>
         › <a href="./">Internals</a> 
         › <a href="./">Search</a> 
        <a id="repo-link" href="https://github.com/ruuda/musium/">GitHub</a>
      </nav>
      <article>
        <h1 id="search">Search<a class="headerlink" href="#search">&para;</a></h1>
<p>Each of the three Musium data types (artists, albums, and tracks) can be
searched from a single search box, that searches all three simultaneously.
To facilitate search, Musium maintains indexes from words to artists, albums,
and tracks. Indexes are sorted on normalized word, so we can locate the words
with a given prefix in logarithmic time.</p>
<h2 id="single-search">Single search<a class="headerlink" href="#single-search">&para;</a></h2>
<p>Musium has a one search box. It should be able to find what you need from a
single query, without the need to select what you are searching for, and without
the need for separate browsers for artists, albums, and tracks, with independent
search functions.</p>
<h2 id="minimal-results">Minimal results<a class="headerlink" href="#minimal-results">&para;</a></h2>
<p>Search should find everything that is relevant, but nothing more. For example,
when searching for “queen”, we should show the artist Queen, but not every
individual track by that artist, otherwise “Dancing Queen” by Abba would get
lost in that noise. Similarly, a search for an artist should not list all albums
by that artist, unless they are relevant results by themselves. This happens for
self-titled albums, but also for the word “who” in “Who’s Next” by The Who, for
instance.</p>
<p>Consider a search for “abba dancing queen”.</p>
<ul>
<li>Suppose we index the track artist in addition to the title, then we would
   find “Dancing Queen” by Abba with this query. But we would also find it for
   the prefix “abba”, which is undesirable.</li>
<li>Suppose we do not index the track artist, then we would not find the track at
   all, because the word “abba” does not occur in the title.</li>
</ul>
<p>On the other hand, if the track artist differs from the album artist (maybe
because it includes a feat. artist, because the track is part of a compilation
album), then we cannot reach that track through the artist search results, so
then we do need to include the track itself, to make it discoverable.</p>
<p>Conclusion:</p>
<ul>
<li>Words that occur in the track artist and also in the album artist, should not
   make the track show up, because we can also reach the track through the
   artist search result.</li>
<li>If we consider the track for a different reason, then the presence of a word
   that does not occur in the track title, but which does occur in the track
   artist, should not cause the track to be excluded.</li>
<li>Words that occur in the track artist, but not in the album artist, should
   make the track show up.</li>
</ul>
<h2 id="search-combinations">Search combinations<a class="headerlink" href="#search-combinations">&para;</a></h2>
<p>We want to support the following queries:</p>
<ul>
<li>Track title only, e.g. “dancing queen”</li>
<li>Album title only, e.g. “arrival”</li>
<li>Album artist only, e.g. “abba”</li>
<li>Track title and artist, e.g. “abba dancing queen”</li>
<li>Album title and artist, e.g. “abba arrival”</li>
</ul>
<p>The following queries are out of scope:</p>
<ul>
<li>Track title and album, e.g. “arrival dancing queen”</li>
<li>Artist, album, and track, e.g. “abba arrival dancing queen”</li>
</ul>
<h2 id="indexes">Indexes<a class="headerlink" href="#indexes">&para;</a></h2>
<p>Based on the above considerations, we need the following indexes:</p>
<ul>
<li>Album artist words.</li>
<li>Album title + album artist words, with a marker to tell whether the entry is
   for the album title or album artist.</li>
<li>Track title + track artist words, with a marker to tell whether the entry is
   for the track title or artist, and if it is for the artist, a marker to tell
   whether the word occurs in the album artist too.</li>
</ul>
      </article>
      <nav id="nav-prev-next">
        <a id="nav-prev" href="../api/" title="API Reference">Previous</a>
        <a id="nav-next" href="../performance/" title="Performance">Next</a>
        </nav>
      </div>
    <aside>
      <nav>
        <ul>
        <li class="toc-section"><a href="..">Overview</a></li>
          <li class="toc-section
            "><a href="../building/">User Guide</a></li>
          
            <li class="toc-chapter
              "><a href="../building/">Building</a></li>
            
            <li class="toc-chapter
              "><a href="../configuration/">Configuration</a></li>
            
            <li class="toc-chapter
              "><a href="../running/">Running</a></li>
            
            <li class="toc-chapter
              "><a href="../webinterface/">Webinterface</a></li>
            
            <li class="toc-chapter
              "><a href="../tagging/">Tagging</a></li>
            
            <li class="toc-chapter
              "><a href="../loudness/">Loudness normalization</a></li>
            
            <li class="toc-chapter
              "><a href="../scrobbling/">Scrobbling to Last.fm</a></li>
            
            <li class="toc-chapter
              "><a href="../listenbrainz/">Submitting to Listenbrainz</a></li>
            
            <li class="toc-chapter
              "><a href="../tradfri/">Trådfri control</a></li>
            
            <li class="toc-chapter
              "><a href="../disks/">Disks</a></li>
            
            <li class="toc-chapter
              "><a href="../changelog/">Changelog</a></li>
            <li class="toc-section"><a href="../api/">API Reference</a></li>
          <li class="toc-section
            "><a href="./">Internals</a></li>
          
            <li class="toc-chapter
               current"><a href="./">Search</a></li>
            <li><ul>
                <li class="toc-heading"><a href="#single-search">Single search</a></li>
                <li class="toc-heading"><a href="#minimal-results">Minimal results</a></li>
                <li class="toc-heading"><a href="#search-combinations">Search combinations</a></li>
                <li class="toc-heading"><a href="#indexes">Indexes</a></li>
                </ul></li>
               
            <li class="toc-chapter
              "><a href="../performance/">Performance</a></li>
            
            <li class="toc-chapter
              "><a href="../thumbnails/">Thumbnails</a></li>
            </ul>
      </nav>
    </aside>
  </div>
</body>
</html>